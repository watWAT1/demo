import streamlit as st
import pandas as pd
import numpy as np

# è®¾ç½®é¡µé¢é…ç½®
st.set_page_config(page_title="å—å®ç¾é£Ÿæ•°æ®ä»ªè¡¨ç›˜", layout="wide")

# åº”ç”¨æ ‡é¢˜
st.title("ğŸœ å—å®ç¾é£Ÿæ•°æ®åˆ†æä»ªè¡¨ç›˜")
st.markdown("å±•ç¤ºå—å®æœ¬åœ°ç¾é£Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é¤å…è¯„åˆ†ã€ä»·æ ¼èµ°åŠ¿å’Œåœ°ç†ä½ç½®åˆ†å¸ƒ")

# 1. å—å®é¤å…åŸºæœ¬ä¿¡æ¯æ•°æ®æ¡†
restaurants_data = {
    "é¤å…åç§°": ["èˆ’è®°è€å‹ç²‰ï¼ˆä¸ƒæ˜Ÿè·¯åº—ï¼‰", "æ¡‚å°å¨å¹¿è¥¿èœï¼ˆä¸‡è±¡åŸåº—ï¼‰", "ä¹Œå¸ƒèŠ±å›­é¤å…ï¼ˆé’å±±åº—ï¼‰", 
              "ç”˜å®¶ç•ŒæŸ æª¬é¸­(æ˜¥æ™–åº—)", "ç±³é©¬æ²³ï¼ˆç«¹å¡˜è·¯æ€»åº—ï¼‰", "æµ·åº•æç«é”…(èˆªæ´‹åº—)", 
              "ä¸«ä¸«å¨å¨˜Â·æŸ æª¬é¸­ï¼ˆè¥¿å…³åº—ï¼‰", "å—æ¹–åéƒ½å¤§é¥­åº—Â·æ™¯æ¹–è½©", "é±¼ä¸ŠÂ·é»‘è±†èŠ±çƒ¤é±¼ï¼ˆä¸‡è±¡åŸåº—ï¼‰"],
    "èœç³»ç±»å‹": ["å°åƒå¿«é¤", "å¹¿è¥¿èœ", "ä¸œå—äºšæ–™ç†", "å¹¿è¥¿èœ", "å¹¿è¥¿èœ", "ç«é”…", 
              "å¹¿è¥¿èœ", "è‡ªåŠ©é¤", "å·èœçƒ¤é±¼"],
    "è¯„åˆ†": [4.4, 4.6, 4.6, 5.0, 4.3, 4.6, 4.5, 4.8, 4.2],
    "äººå‡ä»·æ ¼(å…ƒ)": [25, 85, 120, 80, 60, 110, 75, 180, 70],
    "è¯„è®ºæ•°é‡": [840, 839, 183, 54, 224, 1200, 48, 56, 247],
    "åŒºåŸŸ": ["é’ç§€åŒº", "é’ç§€åŒº", "é’ç§€åŒº", "é’ç§€åŒº", "é’ç§€åŒº", "é’ç§€åŒº", "è¥¿ä¹¡å¡˜åŒº", "é’ç§€åŒº", "é’ç§€åŒº"],
    "latitude": [22.815, 22.812, 22.806, 22.817, 22.819, 22.811, 22.824, 22.802, 22.812],
    "longitude": [108.321, 108.372, 108.366, 108.369, 108.351, 108.375, 108.319, 108.358, 108.372]
}

# åˆ›å»ºé¤å…æ•°æ®æ¡†
restaurants_df = pd.DataFrame(restaurants_data)
restaurants_df.index = pd.Series(range(1, len(restaurants_df)+1), name='åºå·')

# 2. åˆ›å»º5å®¶é¤å…12ä¸ªæœˆçš„ä»·æ ¼èµ°åŠ¿æ•°æ®
# æœˆä»½æ•°æ®
months = [f'{i}æœˆ' for i in range(1, 13)]

# é¤å…ä»·æ ¼èµ°åŠ¿æ•°æ®
price_trend_data = {
    "æœˆä»½": months * 5,
    "é¤å…": (["èˆ’è®°è€å‹ç²‰"]*12 + ["æ¡‚å°å¨å¹¿è¥¿èœ"]*12 + ["ä¹Œå¸ƒèŠ±å›­é¤å…"]*12 + 
           ["ç”˜å®¶ç•ŒæŸ æª¬é¸­"]*12 + ["æµ·åº•æç«é”…"]*12),
    "äººå‡ä»·æ ¼": [
        # èˆ’è®°è€å‹ç²‰ - ä»·æ ¼æ³¢åŠ¨è¾ƒå°
        25, 24, 26, 25, 26, 27, 28, 27, 26, 25, 26, 24,
        # æ¡‚å°å¨å¹¿è¥¿èœ - å¹³ç¨³ç•¥æœ‰ä¸Šå‡
        85, 82, 84, 86, 88, 90, 92, 91, 89, 87, 85, 83,
        # ä¹Œå¸ƒèŠ±å›­é¤å… - æœ‰æ˜æ˜¾ä¸Šå‡è¶‹åŠ¿
        120, 125, 130, 128, 132, 135, 140, 138, 142, 145, 148, 150,
        # ç”˜å®¶ç•ŒæŸ æª¬é¸­ - å­£èŠ‚æ€§æ³¢åŠ¨
        80, 78, 82, 85, 83, 80, 78, 82, 85, 88, 86, 84,
        # æµ·åº•æç«é”… - é€æ­¥ä¸Šæ¶¨
        110, 112, 115, 118, 120, 122, 125, 123, 121, 119, 117, 115
    ]
}

# åˆ›å»ºä»·æ ¼èµ°åŠ¿æ•°æ®æ¡†
price_trend_df = pd.DataFrame(price_trend_data)

# é‡æ–°æ•´ç†æ•°æ®æ ¼å¼ï¼Œç”¨äºæŠ˜çº¿å›¾å±•ç¤º
pivot_df = price_trend_df.pivot(index='æœˆä»½', columns='é¤å…', values='äººå‡ä»·æ ¼')
pivot_df = pivot_df.reindex(months)  # ç¡®ä¿æœˆä»½é¡ºåºæ­£ç¡®

# 3. å¼€å§‹åˆ›å»ºä»ªè¡¨ç›˜ç•Œé¢
# å±•ç¤ºå…³é”®æŒ‡æ ‡
st.header("ğŸ“Š å—å®ç¾é£Ÿå…³é”®æŒ‡æ ‡")
col1, col2, col3, col4 = st.columns(4)

with col1:
    st.metric("é¤å…æ•°é‡", len(restaurants_df))

with col2:
    avg_price = restaurants_df['äººå‡ä»·æ ¼(å…ƒ)'].mean()
    st.metric("å¹³å‡äººå‡ä»·æ ¼", f"Â¥{avg_price:.1f}")

with col3:
    avg_rating = restaurants_df['è¯„åˆ†'].mean()
    st.metric("å¹³å‡è¯„åˆ†", f"{avg_rating:.1f}/5.0")

with col4:
    total_reviews = restaurants_df['è¯„è®ºæ•°é‡'].sum()
    st.metric("æ€»è¯„è®ºæ•°", f"{total_reviews}")

# å±•ç¤ºé¤å…æ•°æ®è¡¨æ ¼
st.header("ğŸ“‹ å—å®é¤å…è¯¦ç»†ä¿¡æ¯")
st.dataframe(
    restaurants_df[['é¤å…åç§°', 'èœç³»ç±»å‹', 'è¯„åˆ†', 'äººå‡ä»·æ ¼(å…ƒ)', 'è¯„è®ºæ•°é‡', 'åŒºåŸŸ']],
    use_container_width=True
)

# åˆ›å»ºå¤šåˆ—å¸ƒå±€
col1, col2 = st.columns(2)

# å·¦ä¾§åˆ—ï¼šæ¡å½¢å›¾å’Œé¢ç§¯å›¾
with col1:
    st.header("ğŸ“ˆ é¤å…æ•°æ®åˆ†æ")
    
    # æ¡å½¢å›¾ï¼šå„èœç³»å¹³å‡è¯„åˆ†å¯¹æ¯”
    st.subheader("å„èœç³»å¹³å‡è¯„åˆ†å¯¹æ¯”ï¼ˆæ¡å½¢å›¾ï¼‰")
    # å‡†å¤‡æ•°æ®ï¼šè®¡ç®—å„èœç³»çš„å¹³å‡è¯„åˆ†
    cuisine_rating = restaurants_df.groupby('èœç³»ç±»å‹')['è¯„åˆ†'].mean().reset_index()
    cuisine_rating = cuisine_rating.sort_values('è¯„åˆ†', ascending=False)
    # åˆ›å»ºæ¡å½¢å›¾
    st.bar_chart(cuisine_rating.set_index('èœç³»ç±»å‹'))
    
    # é¢ç§¯å›¾ï¼šå„åŒºåŸŸé¤å…æ•°é‡åˆ†å¸ƒ
    st.subheader("å„åŒºåŸŸé¤å…æ•°é‡åˆ†å¸ƒï¼ˆé¢ç§¯å›¾ï¼‰")
    area_counts = restaurants_df['åŒºåŸŸ'].value_counts().reset_index()
    area_counts.columns = ['åŒºåŸŸ', 'é¤å…æ•°é‡']
    area_counts = area_counts.sort_values('åŒºåŸŸ')
    st.area_chart(area_counts.set_index('åŒºåŸŸ'))

# å³ä¾§åˆ—ï¼šæŠ˜çº¿å›¾å’Œåœ°å›¾
with col2:
    st.header("ğŸ“Š ä»·æ ¼è¶‹åŠ¿ä¸åœ°ç†ä½ç½®")
    
    # æŠ˜çº¿å›¾ï¼š5å®¶é¤å…12ä¸ªæœˆä»·æ ¼èµ°åŠ¿
    st.subheader("5å®¶é¤å…12ä¸ªæœˆä»·æ ¼èµ°åŠ¿ï¼ˆæŠ˜çº¿å›¾ï¼‰")
    st.line_chart(pivot_df)
    
    # åœ°å›¾ï¼šå±•ç¤ºé¤å…åœ°ç†ä½ç½®
    st.subheader("ğŸ—ºï¸ é¤å…åœ°ç†ä½ç½®åˆ†å¸ƒï¼ˆåœ°å›¾ï¼‰")
    
    # å‡†å¤‡åœ°å›¾æ•°æ®
    map_data = restaurants_df[['latitude', 'longitude']].copy()
    map_data.columns = ['lat', 'lon']
    
    # æ˜¾ç¤ºåœ°å›¾
    st.map(map_data)
    
    # åœ¨åœ°å›¾ä¸‹æ–¹æ˜¾ç¤ºå¯¹åº”çš„é¤å…åç§°
    st.caption("åœ°å›¾æ ‡è®°å¯¹åº”çš„é¤å…ï¼š")
    for idx, row in restaurants_df.iterrows():
        st.markdown(f"ğŸ“ **{row['é¤å…åç§°']}** - {row['èœç³»ç±»å‹']} (è¯„åˆ†: {row['è¯„åˆ†']}, äººå‡: Â¥{row['äººå‡ä»·æ ¼(å…ƒ)']})")

# ä»·æ ¼è¶‹åŠ¿è¯¦ç»†æ•°æ®è¡¨æ ¼
st.header("ğŸ’° ä»·æ ¼è¶‹åŠ¿è¯¦ç»†æ•°æ®")
st.write("ä»¥ä¸‹æ˜¯5å®¶é¤å…12ä¸ªæœˆçš„äººå‡ä»·æ ¼å˜åŒ–æ•°æ®ï¼ˆå•ä½ï¼šå…ƒï¼‰")
st.dataframe(pivot_df, use_container_width=True)
